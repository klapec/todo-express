!function e(t,n,i){function r(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[o]={exports:{}};t[o][0].call(d.exports,function(e){var n=t[o][1][e];return r(n?n:e)},d,d.exports,e,t,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("./model"),s=i(o),l=e("./view"),u=i(l),d=e("./controller"),c=i(d),f=new s["default"],k=new u["default"],m=new c["default"](f,k),p=function(){function e(){r(this,e),this.model=f,this.view=k,this.controller=m}return a(e,[{key:"init",value:function(){this.controller.bindAll()}}]),e}(),v=new p;v.init()},{"./controller":2,"./model":3,"./view":4}],2:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t,n){i(this,e),this.model=t,this.view=n}return r(e,[{key:"bindAll",value:function(){var e=this;"/tasks"===window.location.pathname&&(this.view.bind("init"),this.view.bind("addTask",function(t){e.addTask(t.title)}),this.view.bind("editTask"),this.view.bind("editTaskDone",function(t){e.editTaskDone(t.id,t.title,t.oldVal)}),this.view.bind("editTaskCancel"),this.view.bind("removeTask",function(t){e.removeTask(t)}),this.view.bind("toggleTask",function(t){e.toggleTask(t.id,t.completed)}),this.view.bind("removeCompleted",function(t){e.removeTask(t)}))}},{key:"addTask",value:function(e){var t=this;""!==e.trim()&&(this.view.render("addTask",{title:e}),this.model.create(e).then(function(n){var i=JSON.parse(n);t.view.render("updateTaskId",{title:e,id:i.id})},function(n){t.view.render("addTask",{err:n,title:e})}))}},{key:"editTaskDone",value:function(e,t,n){var i=this;""!==t.trim()&&t!==n?(this.view.render("editTaskDone",{id:e,title:t}),this.model.update(e,{title:t})["catch"](function(r){i.view.render("editTaskDone",{err:r,id:e,title:t,oldVal:n})})):this.view.render("editTaskDone",{id:e,title:n})}},{key:"removeTask",value:function(e){var t=this,n=e.completed?e.completed.join("&"):e.id;this.view.render("removeTask",{query:e.id?[e.id]:e.completed}),this.model.remove(n)["catch"](function(n){t.view.render("removeTask",{err:n,args:e})})}},{key:"toggleTask",value:function(e,t){var n=this;this.view.render("toggleTask",{id:e,completed:t}),this.model.update(e,{completed:t})["catch"](function(i){n.view.render("toggleTask",{err:i,id:e,completed:t})})}}]),e}();n["default"]=a,t.exports=n["default"]},{}],3:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(){i(this,e)}return r(e,[{key:"create",value:function(e){return new Promise(function(t,n){var i=new XMLHttpRequest;i.onload=function(){200===i.status?t(i.responseText):n(Error(i.statusText))},i.onerror=function(){n(Error("Network error"))},i.open("post","/tasks",!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify({title:e}))})}},{key:"update",value:function(e,t){return new Promise(function(n,i){var r=new XMLHttpRequest;r.onload=function(){200===r.status?n(r.responseText):i(Error(r.statusText))},r.onerror=function(){i(Error("Network error"))},r.open("put","/tasks/"+e,!0),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(JSON.stringify(t))})}},{key:"remove",value:function(e){return new Promise(function(t,n){var i=new XMLHttpRequest;i.onload=function(){200===i.status?t(i.responseText):n(Error(i.statusText))},i.onerror=function(){n(Error("Network error"))},i.open("delete","/tasks/"+e,!0),i.send()})}}]),e}();n["default"]=a,t.exports=n["default"]},{}],4:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(e,t){return(t||document).querySelector(e)},o=function(e,t){return(t||document).querySelectorAll(e)},s=function(e,t){for(var n=!0;n;){var i=e,r=t;if(n=!1,!i.parentNode)return!1;if(i.parentNode.tagName.toLowerCase()===r.toLowerCase())return i.parentNode;e=i.parentNode,t=r,n=!0}},l=function(e,t,n,i){"object"==typeof t?t.forEach(function(t){e.addEventListener(t,n,!!i)}):e.addEventListener(t,n,!!i)},u=function(e,t,n,i){function r(n){var r=n.target,a=o(t,e),s=Array.prototype.indexOf.call(a,r)>=0;s&&i.call(r,n)}var a="blur"===n||"focus"===n;l(e,n,r,a)},d=function(){function e(){i(this,e),this.ENTER_KEY=13,this.ESCAPE_KEY=27,this.addTaskInput=a(".add-task__name"),this.addTaskButton=a(".add-task__button"),this.taskList=a(".task-list"),this.taskListCounter=a(".task-counter"),this.taskListError=a(".task-list__error"),this.taskCounter=a(".task-counter"),this.clearCompleted=a(".clear-completed"),this.oldValueCache=""}return r(e,[{key:"itemId",value:function(e){var t=s(e,"li");return t.dataset.id}},{key:"clearCompletedButton",value:function(e){this.clearCompleted.style.display=e?"block":"none"}},{key:"itemCounter",value:function(e){var t=[];Array.prototype.forEach.call(o(".completed"),function(e){t.push(e.dataset.id)});var n=this.taskList.children.length-t.length,i=1===n?"":"s";return e?t:(this.clearCompletedButton(t.length),void(this.taskListCounter.textContent=n+" task"+i+" left"))}},{key:"displayError",value:function(e){this.taskListError.style.display="block";var t=document.createElement("h3");t.textContent=e,this.taskListError.appendChild(t);var n=document.createElement("span");n.textContent="Something wrong happened. I'm working on it.",this.taskListError.appendChild(n)}},{key:"hideError",value:function(){this.taskListError.style.display="none"}},{key:"bind",value:function(e,t){var n=this,i={init:function(){l(document,"DOMContentLoaded",function(){n.render("init")})},addTask:function(){l(n.addTaskInput,"keypress",function(e){e.keyCode===n.ENTER_KEY&&t({title:this.value})}),l(n.addTaskButton,["mouseup","keypress"],function(){t({title:n.addTaskInput.value})})},editTask:function(){u(n.taskList,".task-list__item__name","dblclick",function(){n.render("editTask",{id:n.itemId(this)})})},editTaskDone:function(){u(n.taskList,".task-list__item--edit","blur",function(){this.dataset.iscanceled||t({id:n.itemId(this),title:this.value,oldVal:n.oldValueCache})}),u(n.taskList,".task-list__item--edit","keypress",function(e){e.keyCode===n.ENTER_KEY&&this.blur()})},editTaskCancel:function(){u(n.taskList,".task-list__item--edit","keyup",function(e){e.keyCode===n.ESCAPE_KEY&&(this.dataset.iscanceled=!0,this.blur(),n.render("editTaskDone",{id:n.itemId(this),title:n.oldValueCache}))})},removeTask:function(){u(n.taskList,".task-list__item__delete","click",function(){t({id:n.itemId(this)})})},toggleTask:function(){u(n.taskList,".task-list__item__toggle","click",function(){var e=void 0;-1!==this.className.search(/checked/)?(e=!1,this.className="task-list__item__toggle"):(e=!0,this.className+=" checked"),t({id:n.itemId(this),completed:e})})},removeCompleted:function(){l(n.clearCompleted,"click",function(){t({completed:n.itemCounter(!0)})})}};i[e]()}},{key:"render",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{id:""}:arguments[1],n=this,i=a('[data-id="'+t.id+'"]');if(t.err)return n.displayError(t.err);n.hideError();var r={init:function(){n.itemCounter()},addTask:function(){n.addTaskInput.value="";var e=document.createElement("li");e.className="task-list__item",e.dataset.id=t.id?t.id:"";var i=document.createElement("div");i.className="task-list__item--view",e.appendChild(i);var r=document.createElement("span");r.className="task-list__item__toggle",i.appendChild(r);var a=document.createElement("label");a.className="task-list__item__name",a.textContent=t.title,i.appendChild(a);var o=document.createElement("button");o.className="task-list__item__delete",i.appendChild(o),n.taskList.appendChild(e),n.itemCounter()},updateTaskId:function(){var e=o(".task-list__item"),n=void 0;Array.prototype.forEach.call(e,function(i,r){a("label",e[r]).textContent===t.title&&(n=i)}),n.dataset.id=t.id},editTask:function(){var e=document.createElement("input"),t=a("label",i).textContent;n.oldValueCache=t,i.className=i.className+" editing",e.className="task-list__item--edit",i.appendChild(e),e.focus(),e.value=t},editTaskDone:function(){var e=a(".task-list__item--edit",i),n=a(".task-list__item__name",i);i.removeChild(e),i.className=i.className.replace("editing",""),n.textContent=t.title},removeTask:function(){return t.query.forEach(function(e){var t=a('[data-id="'+e+'"]');n.taskList.removeChild(t)}),n.itemCounter()},toggleTask:function(){i.className=t.completed?"task-list__item completed":"task-list__item",n.itemCounter()}};r[e]()}}]),e}();n["default"]=d,t.exports=n["default"]},{}]},{},[1]);